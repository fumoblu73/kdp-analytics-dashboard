<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDP Analytics Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f8fafc;
            color: #1a202c;
            line-height: 1.5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 8px;
        }
        .login-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #374151;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }
        .login-button {
            width: 100%;
            background: #3b82f6;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
        }
        .summary-card .value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #3b82f6;
        }
        .summary-card .label {
            color: #718096;
            font-size: 14px;
            text-transform: uppercase;
        }
        .books-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a202c;
        }
        .book-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 12px;
        }
        .book-cover {
            width: 50px;
            height: 70px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }
        .book-info {
            flex: 1;
        }
        .book-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #1a202c;
        }
        .book-meta {
            font-size: 14px;
            color: #6b7280;
        }
        .book-revenue {
            text-align: right;
            font-weight: 600;
            color: #059669;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        .hidden {
            display: none;
        }
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            text-align: center;
            font-size: 14px;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
        }
        .info {
            background: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loginSection" class="login-section">
            <div class="header">
                <h1>KDP Analytics Dashboard</h1>
                <p>Professional analytics for your publishing business</p>
            </div>
            
            <div class="form-group">
                <label for="email">Email Address:</label>
                <input type="email" id="email" placeholder="your.email@example.com" value="demo@kdpanalytics.com">
            </div>
            
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Your password" value="demo123">
            </div>
            
            <button class="login-button" onclick="handleLogin()">Access Dashboard</button>
            
            <div id="loginMessage" class="status-message" style="display: none;"></div>
        </div>

        <div id="dashboardSection" class="hidden">
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
            
            <div class="header">
                <h1>KDP Analytics Dashboard</h1>
                <p>Last updated: <span id="lastUpdate">Never</span></p>
            </div>

            <div class="summary-grid">
                <div class="summary-card">
                    <div class="value" id="totalRevenue">$0.00</div>
                    <div class="label">Total Revenue</div>
                </div>
                <div class="summary-card">
                    <div class="value" id="totalOrders">0</div>
                    <div class="label">Total Orders</div>
                </div>
                <div class="summary-card">
                    <div class="value" id="totalBooks">0</div>
                    <div class="label">Books Found</div>
                </div>
                <div class="summary-card">
                    <div class="value" id="totalKenp">0</div>
                    <div class="label">KENP Reads</div>
                </div>
            </div>

            <div class="books-section">
                <h2 class="section-title">Your Books</h2>
                <div id="booksList">
                    <div class="empty-state">
                        <h3>No books found yet</h3>
                        <p>Use the browser extension to sync data from your KDP account.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var allBooks = [];
        var dashboardData = {
            totalRevenue: 0,
            totalOrders: 0,
            totalKenp: 0
        };

        window.addEventListener('load', function() {
            if (localStorage.getItem('isLoggedIn') === 'true') {
                showDashboard();
            }
        });

        function handleLogin() {
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;
            
            if (!email || !password) {
                showMessage('Please enter both email and password', 'error');
                return;
            }
            
            showMessage('Connecting to dashboard...', 'info');
            
            setTimeout(function() {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userEmail', email);
                showMessage('Login successful!', 'success');
                
                setTimeout(function() {
                    showDashboard();
                }, 1000);
            }, 1000);
        }

        function handleLogout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('loginSection').classList.remove('hidden');
        }

        function showDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            updateLastUpdateTime();
            setupExtensionListener();
        }

        function showMessage(message, type) {
            var messageDiv = document.getElementById('loginMessage');
            messageDiv.textContent = message;
            messageDiv.className = 'status-message ' + type;
            messageDiv.style.display = 'block';
        }

        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
        }

        function updateSummaryCards() {
            document.getElementById('totalRevenue').textContent = '$' + dashboardData.totalRevenue.toFixed(2);
            document.getElementById('totalOrders').textContent = dashboardData.totalOrders;
            document.getElementById('totalBooks').textContent = allBooks.length;
            document.getElementById('totalKenp').textContent = dashboardData.totalKenp;
        }

        function updateBooksList() {
            var container = document.getElementById('booksList');
            container.innerHTML = '';
            
            if (allBooks.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No books found yet</h3><p>Use the browser extension to sync data from your KDP account.</p></div>';
                return;
            }
            
            allBooks.forEach(function(book) {
                var bookItem = document.createElement('div');
                bookItem.className = 'book-item';
                
                var bookInitials = book.title.substring(0, 2).toUpperCase();
                
                bookItem.innerHTML = 
                    '<div class="book-cover">' + bookInitials + '</div>' +
                    '<div class="book-info">' +
                        '<div class="book-title">' + book.title + '</div>' +
                        '<div class="book-meta">Orders: ' + (book.orders || 0) + ' | KENP: ' + (book.kenp || 0) + '</div>' +
                    '</div>' +
                    '<div class="book-revenue">$' + (book.royalties || 0).toFixed(2) + '</div>';
                
                container.appendChild(bookItem);
            });
        }

        function setupExtensionListener() {
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'KDP_SYNC_DATA') {
                    updateDashboardWithExtensionData(event.data.data);
                }
            });
        }

        function updateDashboardWithExtensionData(data) {
            console.log('Received extension data:', data);
            
            allBooks = [];
            dashboardData = {
                totalRevenue: 0,
                totalOrders: 0,
                totalKenp: 0
            };
            
            if (data.books && data.books.length > 0) {
                allBooks = data.books.map(function(book) {
                    return {
                        title: book.title || 'Unknown Title',
                        royalties: book.royalties || 0,
                        orders: book.orders || 0,
                        kenp: book.kenp || 0,
                        asin: book.asin || '',
                        marketplace: book.marketplace || 'US'
                    };
                });
                
                allBooks.forEach(function(book) {
                    dashboardData.totalRevenue += book.royalties;
                    dashboardData.totalOrders += book.orders;
                    dashboardData.totalKenp += book.kenp;
                });
                
                console.log('Found ' + allBooks.length + ' books');
            }
            
            if (data.summary) {
                if (data.summary.totalRoyalties > 0) {
                    dashboardData.totalRevenue = Math.max(dashboardData.totalRevenue, data.summary.totalRoyalties);
                }
                if (data.summary.totalOrders > 0) {
                    dashboardData.totalOrders = Math.max(dashboardData.totalOrders, data.summary.totalOrders);
                }
            }
            
            updateSummaryCards();
            updateBooksList();
            updateLastUpdateTime();
        }

        function handleSync(data) {
            console.log('Dashboard received sync data:', data);
            updateDashboardWithExtensionData(data);
            return { status: 'success', message: 'Data synced successfully' };
        }

        window.handleSync = handleSync;
    </script>
</body>
</html>
